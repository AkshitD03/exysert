<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/light-results.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dark-results.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <!-- Include jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Include custom JavaScript for theme switching -->
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
  {% include 'header.html' %}
  <style>
    #Links button{
      border-bottom: 2px solid #F92B65;
    }
  </style>

<br>




<br>









<br>










<br>







<style>

</style>
<script>
  function escapeHtml(unsafe) {
      return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
  }

  function fetchTopWidget(query) {
      fetch(`/top_widget/${query}`)
          .then(response => response.json())
          .then(data => {
              if (data.top_widget) {
                  document.getElementById('top_widget').innerHTML = data.top_widget;
              }
          })
          .catch(error => console.error('Error fetching top widget:', error));
  }

  function fetchAIResponse(query) {
      fetch(`/ai_response/${query}`)
          .then(response => response.json())
          .then(data => {
              if (data.ai_resp) {
                  document.getElementById('ai_response').innerHTML = data.ai_resp;
              }
          })
          .catch(error => console.error('Error fetching AI response:', error));
  }

  function toggleExpand() {
            const expandableContent = document.querySelector('.expandable-content');
            const button = document.querySelector('.expand-button');
            if (expandableContent.style.display === 'none') {
                expandableContent.style.display = 'block';
                button.textContent = 'Collapse';
            } else {
                expandableContent.style.display = 'none';
                button.textContent = 'Expand';
            }
        }

  document.addEventListener('DOMContentLoaded', (event) => {
      const query = '{{ search_query }}';
      fetchTopWidget(query);
      fetchAIResponse(query);
  });
    </script>
<pre style="font-size: 1.2em; margin-left: 370px;"><h2>  AI Responce</h2></pre>
    <div id="ai_response">
        <h2>AI Response</h2>
        <p>Loading AI response...</p>
    </div>
    <br>



    <br>
  


    <br>
    <br>






<pre style="font-size: 1.2rem; margin-left: 370px;"><h2>  Snippet</h2></pre>
<div id="top_widget">
    <h2>Exyser Snippet</h2>
    <p>Loading Snippet...</p>
</div>
<br>
<script>
    // Save the scroll position and input field value before unloading
    window.addEventListener('beforeunload', () => {
        const inputField = document.getElementById('inputField').value;
        const scrollPosition = window.scrollY; // Save current scroll position
        localStorage.setItem('inputField', inputField);
        localStorage.setItem('scrollPosition', scrollPosition);
    });

    // Restore the input field and scroll position on page load
    window.addEventListener('load', () => {
        const savedInput = localStorage.getItem('inputField');
        const savedScrollPosition = localStorage.getItem('scrollPosition');

        if (savedInput !== null) {
            document.getElementById('inputField').value = savedInput;
        }

        if (savedScrollPosition !== null) {
            window.scrollTo(0, parseInt(savedScrollPosition, 10));
        }
    });
</script>


<br>




        {% for result in results %}
     <div class="result" >
            <h3><a href="{{ result.link }}">{{ result.title }}</a></h3>
            <h6> {{ result.link }}</h6>
            <div class="rating">
              {{ result.rating | safe }}
          </div>
            <p>{{ result.description }}</p>
          </div>
          <br>




          <br>
  
  
  
  
  
  
  
          
        {% endfor %}


    <form action="/search_q={{ search_query }}&results=more" method="post">
        <input type="hidden" name="search_query" value="{{ search_query }}">
        <input type="hidden" name="num_results" value="{{ results|length }}">
        <button type="submit" name="results" value="more" class="more">More Results</button>
    </form>
    <br>




    <br>




    <br>






    <br>




    <br>




    <br>







</body>
</html>
